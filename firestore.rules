rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    
    // ==================================================
    // Shim Mode Rules (Relaxed for No-Admin-SDK Flow)
    // ==================================================

    // 1. Users Collection
    // - Read: Public (Required for login.js to check simplePassword before auth)
    // - Write: Public (Required for signup.js and account recovery)
    match /users/{userId} {
      allow read, write: if true;
    }

    // 2. App Approvals
    // - Read: Public (Students need to see apps)
    // - Write: Public (Teachers manage approvals)
    match /app_approvals/{document=**} {
      allow read, write: if true;
    }

    // 3. Usage Logs
    // - Read/Write: Public
    match /usage_logs/{document=**} {
      allow read, write: if true;
    }
    
    // 4. Agreements
    match /agreements/{document=**} {
        allow read, write: if true;
    }
    
    // Default: Open for development/shim
    match /{document=**} {
      allow read, write: if true;
    }
  }
}
